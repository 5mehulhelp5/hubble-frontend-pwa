# Platform: Shopware
Contains all files that are related to usage of hubble PWA with Shopware 6.

## api-client
The API Client for this platform is generated by https://github.com/ferdikoomen/openapi-typescript-codegen.

### Generate
To generate / update the client:
1. Create a Shopware Integration (required only once per setup) https://docs.shopware.com/en/shopware-6-en/settings/system/integrationen
2. Set credentials as cli env variables
```shell
export BASEURL=http://localhost
export CLIENT_ID=your-shopware-client-id
export CLIENT_SECRET=your-shopware-client-secret
```
3. Run helper cli script
```shell
npm run sw:dev:generate-api
```

### Patch
Because the client is generated from the swagger comments of shopware, there can be mismatches in types or functions. 
Patch files are applied automatically on client generation. 
In this case you can patch missing or wrong code on your own:

1. Change to root directory
2. Commit your changes to git 
3. Create patch:
```shell
export COMMIT=commit-hash-from-1
npm run sw:dev:patch-api
```
4. Commit generated path file to git 

### Usage
Use api client directly in platform specific composables only to keep backend agnostic.
Given services can be found in shopware/api-client/generated/services
```js
import { CategoryShopware } from '../api-client/generated'

const { data, pending, refresh } = await CategoryShopware.readNavigation(
    'main-navigation',
    'main-navigation',
    {},
    true
)
```

### Custom request.ts
- sets shopware specific default headers: **sw-access-key** and **sw-include-seo-urls**
- sets shopware specific header **sw-context-token** if exists as cookie or in store 
- uses useFetch function of Nuxt 3 to resolve with: data, pending, refresh
- handles errors 

## bin
Contains shopware specific cli helper like api client generation and plugin installation / configuration.

## composables
Contains shopware specific composables. Mostly used to fetch data from api via 
platform specific api client and map them to types / interfaces defined in /runtime/commons. 

## .env_example
Example file for shopware specific environment variables 

## Plugins

### Install Plugins from Shopware 

Plugin data will be dumped from Shopware via API. The dumped zip file will be downloaded and unzipped in /platform-plugins 
of projects rootDir. All plugin slot mapping files will be merged and placed as pluginMapping.json in /platform-plugins
of projects rootDir. 

```shell
npm run hubble dev:sw sw-plugins-assets
```

### Load Plugin Configurations from Shopware

Plugin data will be dumped from Shopware via API. The dumped plugin configuration will be flattened and merged into one
single object, so it can be injected to Nuxt.js public runtimeConfiguration. Config file will be placed in /platform-plugins
of projects rootDir. 

Config values which contain "secret" or "private" or "password", will NOT be injected to avoid to leak sensitive
information. 

Schema of object property:

```json
{
    "camelCasePluginNameConfigName": "some config value" 
}
```

```shell
npm run hubble dev:sw sw-plugins-config
```
